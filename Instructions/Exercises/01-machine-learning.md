---
lab:
  title: 自動機械学習を確認する
---

# 自動機械学習を確認する

この演習では、自動機械学習を使用して、機械学習モデルのトレーニングと評価を行います。 次に、トレーニングしたモデルをデプロイしてテストします。

> **注**:この演習は、***Azure Machine Learning*** を使用してモデルをトレーニングおよびテストする手順を説明することを目的としています。 十分なアクセス許可を持つ Azure サブスクリプションがある場合は、Azure Machine Learning ワークスペースを演習用にプロビジョニングして使用することができます。 ただし、Azure Machine Learning は、膨大な量のデータとクラウドベースのコンピューティングを含むエンタープライズ規模の機械学習ソリューション向けに設計されています。 Azure Machine Learning の一部の操作にはコンピューティングのプロビジョニングが必要であり、これにはかなりの時間がかかる場合があります。 この演習で使用する Azure ML のコア機能を含むブラウザーベースの ***ML Lab*** アプリも提供されており、Azure にアクセスできない場合、または限られた時間で演習を完了する必要がある場合は、これを使用して、Azure ML と同様に、実際の機械学習モデルをトレーニングおよびテストすることができます。 ML Lab のユーザー インターフェイスは Azure Machine Learning と "まったく同じ" ではありませんが、Azure Machine Learning に直感的に移行できるほどよく似ています。** ML Lab アプリはブラウザーで実行されるため、どの時点でもページを更新するとアプリが再起動されることに注意してください。

この演習の所要時間は約 **35** 分です (ブラウザー ベースの ML Lab アプリを使用する場合はそれよりも短くなります)。

## ワークスペースの作成

ワークスペースは、すべての機械学習リソースをまとめて保持するために使用されます。これにより、データ、コード、モデル、その他の資産を 1 か所で簡単に管理できます。

1. このラボで使用する環境用のポータルを開き、メッセージが表示されたらサインインします。
    - Azure ベースの [Azure Machine Learning スタジオ](https://ml.azure.com){:target="_blank"} (`https://ml.azure.com`)
    - ブラウザーベースの [ML Lab](https://aka.ms/ml-lab){:target="_blank"} (`https://aka.ms/ml-lab`)

    > **ヒント**: Azure Machine Learning スタジオが既存のワークスペースで開いている場合は、**[すべてのワークスペース]** ページに移動します。

1. 適切な名前で新しいワークスペースを作成します。

    Azure Machine Learning を使用する場合、この演習では "ハブ" は必要ありません。** Azure サブスクリプションのポリシー制約に基づいて、適切な詳細設定を選択してください。

1. ワークスペースが作成されたら、それを選択して、そのワークスペースの **[ホーム]** ページを表示します。

    ワークスペースには複数のページがあることに注意してください。これらは左側のナビゲーション ウィンドウに表示されます。 このペインを展開したり折りたたんだりするには、上部にある **&#9776;** メニューを使用します。

## データをダウンロードする

この演習では、アイスクリームの売上のデータセットを使用して、季節や気象の特徴に基づいて特定の日のアイスクリームの需要を予測するモデルをトレーニングします。

1. 新しいブラウザー タブで、`https://aka.ms/mslearn-ml-data` からローカル コンピューターに **[ml-data.zip](https://aka.ms/mslearn-ml-data)** をダウンロードします。
1. ダウンロードした **ml-data.zip** アーカイブを抽出して、その中に含まれているファイルを確認します。 これらのファイルの 1 つが **ice-cream.csv** であることに注意してください。このファイルには、この演習に必要なアイスクリームの売上データが含まれています。

## 自動機械学習を使ってモデルをトレーニングする

自動機械学習を使うと、複数のアルゴリズムとパラメーターを試して複数のモデルをトレーニングし、お使いのデータに最適なものを特定できます。

1. ポータルで、**[自動 ML]** ページ (**[オーサリング]** の下にあります) を表示します。

1. 次の設定で新しい自動 ML ジョブを作成し、必要に応じて **[次へ]** を使ってユーザー インターフェイスを進めます。

    > **ヒント**: 以下の手順で設定に関する明示的な情報が提供されていない場合は、既定値を使用します。

    **基本設定**:

    - 自動機械学習ジョブに一意の **[ジョブ名]** を割り当てます

   **タスクの種類とデータ**:

    - タスクの種類を **[回帰]** に設定します。
    - **ice-cream** という名前の新しい***表形式***のデータ資産を作成します
        - ローカルの **ice-cream.csv** ファイルを既定のワークスペース ストレージにアップロードします。
        - 次の列<u>のみ</u>を含めます (*Date* は行ごとに一意であり、それ自体では予測機能はほとんど追加されません)。
            - **DayOfWeek**
            - **Month**
            - **気温**
            - **Rainfall**
            - **IceCreamsSold**
        - データ資産を作成します。
    - 新しく作成した **ice-cream** データ資産が選択されていることを確認してから、次の手順に進みます

    > **注**:自分が管理者ではない Azure サブスクリプションを使用している場合は、ストレージへのキーベースのアクセスがポリシーによって許可されていない可能性があります。 この場合は、管理者と協力してキーベースのアクセスを許可するか、ストレージへのアクセスに Entra ID 認証を使用するように Azure Machine Learning ワークスペースを再構成する必要があります。 これを行うことができない場合は、この演習にブラウザーベースの ***ML Lab*** アプリを使用してください。

    **タスク設定**:

    - **[ターゲット列]** (モデルで予測するラベル) を **[IceCreamsSold]** に設定します。
    - **[追加構成] 設定**を設定します。
        - **[プライマリ メトリック]** を、モデルのパフォーマンスを評価するために使用するメトリックに設定します。 この演習では、*R<sup>2</sup>* スコアを使用します。
        - 試すモデル アルゴリズムを選択します (または、すべて選択したままにします)
    - **[特徴量化] 設定** を設定します。
        - これらの設定を使用して、特徴量化 (モデルのトレーニングのためにデータの特徴を準備する方法) をカスタマイズします
    - **[制限]** を設定します。
        - 制限を使用して、特定の条件に基づいてトレーニング ジョブを早期に終了します。 この演習では、次の制限を設定します。
            - **[Metric score threshold]\(メトリック スコアしきい値\)**: 0.9
            - **実験のタイムアウト (分)**:15
        
        > **注** Azure Machine Learning を使用している場合は、これらの制限を設定することが重要です。アルゴリズムと特徴量化の考えられるすべての組み合わせでトレーニング ジョブを実行すると、何時間もかかる可能性があるためです。

    **コンピューティング:**

    - **[サーバーレス]** コンピューティングを使用します

    **レビュー**

    - 設定を見直して慎重にチェックします。 その後、トレーニング ジョブを送信します。 自動的に開始されます。

1. ジョブが完了するまでお待ちください。

    > **ヒント**: Azure Machine Learning を使用している場合は、しばらく時間がかかる可能性があります。コーヒーでも飲んで待ちましょう。

## 最高のモデルを確認する

自動機械学習ジョブが完了したら、トレーニングした最適なモデルを確認できます。

1. ジョブの詳細ページの **[概要]** タブで、ジョブに関する情報を表示し、最適なモデルの概要をメモします。
  
1. 最適なモデルの**アルゴリズム名**を選択して、詳細を表示します。 次に、子ジョブの詳細ページで、次のタブを表示します。
    - **概要**:子ジョブの一般的な詳細。
    - **モデル**:トレーニングされたモデルに関する情報。
    - **メトリック**: トレーニング プロセス中に使用されたテスト データに基づくモデルの評価メトリックと視覚化。
    - **出力とログ**:トレーニング プロセス中にログされた情報。

## モデルをデプロイしてテストする

1. 自動機械学習ジョブによってトレーニングされた最適なモデルの **[モデル]** タブで、**[デプロイ]** を選択して、モデルをリアルタイム エンドポイントにデプロイします。

    デプロイされたエンドポイントを実行するコンピューティングに適した **[インスタンス]** と **[仮想マシン]** のオプション (Azure サブスクリプションで使用可能なクォータによって異なる場合があります) を選択し、適切な **[エンドポイント名]** と **[デプロイ名]** を割り当てます。

1. デプロイが完了したことを示す通知を待ちます。

    > **ヒント**: Azure Machine Learning スタジオでは、エンドポイントのデプロイに 5 から 10 分かかる場合があります。

## デプロイされたサービスをテストする

これで、デプロイされたサービスをテストできます。

1. ナビゲーション メニューで **[エンドポイント]** ページを選択し、作成したリアルタイム エンドポイントを開きます。

1. [エンドポイント] ページで、**[テスト]** タブを表示します。

1. **[Input data to test endpoint] (テスト エンドポイントへの入力データ)** ペインで、テンプレート JSON を次の入力データに置き換えます。

    ```json
   {
     "input_data": {
        "columns": [
            "DayOfWeek",
            "Month",
            "Temperature",
            "Rainfall"
        ],
        "index": [0],
        "data": [["Wednesday","June",70.5,0.05]]
     }
   }
    ```

1. **[テスト]** ボタンをクリックします。

1. 次のように、入力の特徴に基づいて予測されるレンタル数を含むテスト結果を確認します。

    ```JSON
   [
       120.16208168753236
   ]
    ```

    テスト ペインによって入力データが取得され、トレーニングしたモデルを使用して予測されたレンタル数が返されました。

## モデルを使用するコードを表示する

予測モデルを作成したので、開発者はそれを使用するアプリケーションを構築できます。

1. リアルタイム エンドポイント ページで、**[使用]** タブを表示します。
1. モデルを使用するサンプル コードをレビューします。

## 時間がある場合

自動機械学習をさらに試す場合は、前にダウンロードした **ml-data.zip** アーカイブに含まれていた **penguins.csv** ファイルに基づいて、**[分類]** モデルをトレーニングしてみてください。 このデータセット内のすべての列を使用します。

分類モデルをトレーニングしてデプロイすると、エンドポイントで次の JSON を使用してモデルをテストできます。

```json
{
    "input_data": {
    "columns": [
        "CulmenLength",
        "CulmenDepth",
        "FlipperLength",
        "BodyMass"
    ],
    "index": [0],
    "data": [[45.2,13.8,215,4750]]
    }
}
```

## クリーンアップ

Azure Machine Learning を使用してこの演習を完了した場合は、不要な Azure 使用量が発生しないように、作成したリソースを削除する必要があります。

1. [Azure Machine Learning スタジオ](https://ml.azure.com)の **[エンドポイント]** タブで、デプロイしたエンドポイントを選択します。 次に、**[削除]** を選び、エンドポイントを削除することを確認します。

    コンピューティングを削除すると、サブスクリプションがコンピューティング リソースに対して課金されなくなります。 ただし、サブスクリプションに Azure Machine Learning ワークスペースが存在する限り、データ ストレージに対して少額が課金されます。 Azure Machine Learning の探索を完了したら、Azure Machine Learning ワークスペースとそれに関連付けられたリソースを削除できます。

ワークスペースを削除するには:

1. [Azure portal](https://portal.azure.com) の **[リソース グループ]** ページで、Azure Machine Learning ワークスペースの作成時に指定したリソース グループを開きます。
2. **[リソース グループの削除]** をクリックし、リソース グループ名を入力して削除することを確認し、**[削除]** を選択します。
